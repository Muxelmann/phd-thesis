\section{Optimisation method}
\label{ch1:sec:closed-loop-optimisation-method}

In the previous sections, the key network parameters and associated cost functions have been established, and the data, models and schedule generation is explained.
The key network parameters that are used in this work are:

\begin{itemize}
	\item substation phase voltages, $(v_{\text{ss},\phi}(t)) = \textbf{v}_{ss}(t)$,
	\item ESMU phase voltages, $(v_{\text{ESMU},\phi}(t)) = \textbf{v}_\text{ESMU}(t)$,
	\item all load voltages, $(v_{\text{load},i}(t)) = \textbf{v}_\text{load}(t)$,
	\item substation apparent phase power, $(s_{\text{ss},\phi}(t)) = \textbf{s}_{ss}(t)$,
	\item substation phase currents, $(i_{\text{ss},\phi}(t)) = \textbf{i}_{ss}(t)$,
	\item all line currents, $(i_{\text{line},l,\phi}(t)) = \textbf{i}_\text{line}(t)$, and
	\item all network losses, $s_\text{losses}(t)$.
\end{itemize}

In this section, the method of adjusting the predetermined ESMU schedule on a sub-half-hourly basis is presented.
This method is designed to improve network performance, which in turn is indicated by the aforementioned key network parameters.
After detailing the method itself, the generation and assessment of all results are explained. 

\subsection{Closed-loop schedule adjustment}

To summarise all costs, that are derived from the key network parameters, a global cost is generated and formalised as follows:

\input{_chapter1/equ/weighted-sum-cost-function}

Here, $\boldsymbol{\alpha}$ is a binary choice vector, with which the weight of the global cost function can easily be adjusted.
In other words, this vector allows the global cost to target any specific key network improvement, which is based on a specific cost.
To simplify the notation, and since all key network parameters are outputs of the power flow simulations and not directly adjustable, the global cost function is shortened to $\zeta(\boldsymbol{\alpha})$.

\input{_chapter1/fig/closed-loop-optimisation}

\nomenclature[I]{$\delta\textbf{s}_\text{ESMU}(t)$}{Three-phase apparent ESMU power adjustment vector at time $t$, where $(\delta s_{\text{ESMU},\phi}(t)) = \delta \textbf{s}_\text{ESMU}(t)$ and $\delta \textbf{s}_\text{ESMU}(t) \in \mathbb{C}^\Phi$ (Chapter \ref{ch1})}
\nomenclature[I]{$\delta s_{\text{ESMU}, \phi}(t)$}{Three-phase apparent ESMU power adjustment vector at time $t$, where $(\delta s_{\text{ESMU},\phi}(t)) = \delta \textbf{s}_\text{ESMU}(t)$ and $\delta s_{\text{ESMU},\phi}(t) \in \mathbb{C}$ (Chapter \ref{ch1})}

The underlying method that performs the proposed closed-loop optimisation is shown in Figure \ref{ch1:fig:closed-loop-optimisation}.
For each time-slot, $t$, the pre-scheduled ESMU power vector, $\textbf{s}_\text{ESMU}(t)$, is extracted and adjusted by an offset vector, $\delta \textbf{s}_\text{ESMU}(t)$.
An optimal offset vector is found through iterative optimisation to minimise the global cost function, $\zeta(\boldsymbol{\alpha})$.
This minimisation is achieved by repetitively running power flow simulations of the IEEE distribution feeder and adjusting $\delta\textbf{s}_\text{ESMU}(t)$.
Once the adjusted ESMU schedule (i.e. $\textbf{s}_\text{ESMU}(t) + \delta \textbf{s}_\text{ESMU}(t)$) has converged and a solution has been found, then the closed-loop optimisation process terminates and the simulation begins optimisation during the next time slot (i.e. $t+\Delta t$).
Since $\delta \textbf{s}_\text{ESMU}(t)$ must not impact the underlying half-hourly ESMU schedule, one more constraint is defined.
This constraint assures that the sum of all phase powers in the adjustment vector equates to zero, hence keeping the internal battery's charging-discharge power the same.
Including the previously mentioned battery system constraints, which ensure that the ESMU operates within its technical limitations, the minimisation problem for the closed-loop optimisation mechanism is formulated as follows:

\input{_chapter1/equ/closed-loop-minimisation}

\subsection{Execution and result assessment procedure}
\label{ch1:subsec:method-execution}

After having established what parameters to focus on when trying to improve network operation, and after having established how the closed-loop optimising method aims to achieve this improvement, the performance assessment for the improvement method is introduced now.
To support the explanation of the evaluation procedure, the entire assessment procedure is captured in Figure \ref{ch1:fig:method-evaluation-flowchart}.

\input{_chapter1/fig/method-evaluation-flowchart}

All in all, there are eleven datasets of simulation results to be assessed and compared.
These results are obtained from a \textit{base} simulation, a \textit{normal} simulation and nine additional simulations where individual cost-functions were minimised.
More specifically, the \textit{base} case is the outcome of running an entire day of power profiles without any ESMU intervention.
This case represents the baseline or network performance which should be improved by any ESMU intervention.
The \textbf{normal} case captures the simplest of all ESMU interventions, since for this case, the ESMU executes its normal half-hourly schedule without any additional schedule modification.
Comparing the \textit{base} and \textit{normal} cases dies show the direct impact of the ESMU on the network's operation.
As mentioned above, the remaining nine datasets are results of nine different cases where the ESMU schedule is adjusted on a sub-half-hourly level.
The adjustment for each case is designed to minimise one underlying cost-function, whilst conforming to the ESMU's overall half-hourly charging and discharging profile.
In order to treat each cost-function separately $\boldsymbol{\alpha}$ is set to focus on each cost independently, e.g. by setting $\alpha_1 = 1 \text{ and } \alpha_2 = \alpha_3 = \dots = \alpha_9 = 0$.
For simplicity, the flowchart in Figure \ref{ch1:fig:method-evaluation-flowchart} abbreviates the specific costs by only indicating which entry in the $\boldsymbol{\alpha}$ vector is set to $1$, e.g. $\zeta(\alpha_1=1)$ for the preceding example.

All eleven datasets are then assessed in the same manner in order to compare the impact they had had on the network performance.
This underlying assessment is broken into three parts for each dataset:

\begin{enumerate}
	\item \textbf{Time Series Analysis} - 
	The underlying raw profiles are plotted and compared against their respective counterpart cases, in order to link the immediate network impacts to their physical meaning.
	For the same profiles, their corresponding cost profiles are calculated plotted.
	This is done to to highlight how the profiles are interpreted by the cost-functions in terms of improvement (i.e. lower cost) or worsening (i.e. increased cost).
	\item \textbf{Difference Analysis} - 
	The difference in cost profiles, compared to the respective \textit{base} or \textit{normal} case, is calculated and boxplots of these differences are presented to show a statistical spread of improvements or worsening.
	For these plots, a generally positive boxplot skew indicates a general improvement of the underlying network parameters, whilst a generally negative skew does indicate worse performance in regards to the underlying network parameters.
	\item \textbf{Probability Density Analysis} - 
	A set of Probability Density Functions (PDF) is derived for each cost profile using the well established kernel density estimation.
	These PDFs indicate the probability that a certain cost value occurs.
	An improvement is noted when the PDF is shifted towards the lower cost values, whereas a shift towards higher cost values worsened the network performance.
\end{enumerate}





