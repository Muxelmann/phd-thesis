\section{Closed-Loop Optimisation Method}
\label{ch1:sec:closed-loop-optimisation-method}

In the previous two sections, the key network parameters and associated cost functions have been established.
Then the used network models, data and battery models were explained.
Now, the implemented method on generating a traditional ESMU schedules is presented, before presenting the novel approach of adjusting this schedule using on-line readings.

%\subsection{ESMU Schedule Generation}
%\label{ch1:subsec:esmu-schedule-generation}

\subsection{Closed-Loop Schedule Adjustment}

To quickly summarise, the following key network parameters are used in this chapter:

\begin{itemize}
	\item substation phase voltages, $(v_{\text{ss},\phi}(t)) = \textbf{v}_{ss}(t)$,
	\item ESMU phase voltages, $(v_{\text{ESMU},\phi}(t)) = \textbf{v}_\text{ESMU}(t)$,
	\item all load voltages, $(v_{\text{load},i}(t)) = \textbf{v}_\text{load}(t)$,
	\item substation apparent phase power, $(s_{\text{ss},\phi}(t)) = \textbf{s}_{ss}(t)$,
	\item substation phase currents, $(i_{\text{ss},\phi}(t)) = \textbf{i}_{ss}(t)$,
	\item all line currents, $(i_{\text{line},l,\phi}(t)) = \textbf{i}_\text{line}(t)$, and
	\item all network losses, $s_\text{losses}(t)$.
\end{itemize}

Together with these key network parameters, and the cost functions defined in Section \ref{ch1:sec:key-network-parameters}, a weighted sum of all costs is generated and formalised into the following global cost function:

\input{_chapter1/equ/weighted-sum-cost-function}

Here, $\boldsymbol{\alpha}$ is a binary choice vector, with which the weight of the global cost function can easily be adjusted.
In other words, this vector allows to target the network improvement based by focusing on a specific cost, rather than optimising the network operation based on the complete set of (sometimes contradicting) costs.
Since all key network parameters are outputs of the power flow simulations and not directly adjustable, and for simpler notations throughout this section, the global cost function is shortened to $\zeta(\boldsymbol{\alpha})$.

\input{_chapter1/fig/closed-loop-optimisation}

The underlying method that performs the proposed closed-loop optimisation is captured in the next Figure \ref{ch1:fig:closed-loop-optimisation}.
Here, for each time slot, $t$, a pre-scheduled ESMU power vector, $\textbf{s}_\text{ESMU}(t)$, is extracted and adjusted by an offset vector, $\delta \textbf{s}_\text{ESMU}(t)$.
This offset vector is found through the aforementioned optimiser that minimises the global cost function, $\zeta(\boldsymbol{\alpha})$, by repetitively running power flow simulations of the IEEE distribution feeder.
Once the adjusted ESMU schedule (i.e. $\textbf{s}_\text{ESMU}(t) + \delta \textbf{s}_\text{ESMU}(t)$) is no longer changed by the optimiser, the closed-loop optimisation process ends and the simulation continues to the next time slot (i.e. $t+\Delta t$).

Since $\delta \textbf{s}_\text{ESMU}(t)$ must not impact the underlying half-hourly ESMU schedule, one more constraint is defined.
This constraint assures that the sum of all phase powers in the adjustment vector equates to zero, hence keeping the internal battery's dis/charging power the same.
Including the previously mentioned battery system constraints, which ensure that the ESMU operates within its technical limitations (e.g. to not over- or undercharge the battery), the minimisation problem for the closed-loop optimisation mechanism can be formulated as follows:

\input{_chapter1/equ/closed-loop-minimisation}


\subsection{Method Execution and Result Assessment Procedure}
\label{ch1:subsec:method-execution}

After having established what parameters to focus on when trying to improve network operation, and after having established how the closed-loop optimising method aims to achieve this improvement, the performance assessment for the improvement method is introduced now.
To support the explanation of the evaluation procedure, the entire assessment procedure is captured in Figure \ref{ch1:fig:method-evaluation-flowchart}.

\input{_chapter1/fig/method-evaluation-flowchart}

All in all, there are eleven datasets of simulation results to be assessed and compared.
These results are obtained from a \textit{base} simulation, a \textit{normal} simulation and nine additional simulations where individual cost-functions were minimised.
More specifically, the \textit{base} case is the outcome of running an entire day of power profiles without any ESMU intervention.
This case represents the baseline or network performance which should be improved by any ESMU intervention.
The \textbf{normal} case captures the simplest of all ESMU interventions, since for this case, the ESMU executes its normal half-hourly schedule without any additional schedule modification.
Comparing the \textit{base} and \textit{normal} cases dies show the direct impact of the ESMU on the network's operation.
As mentioned above, the remaining nine datasets are results of nine different cases where the ESMU schedule is adjusted on a sub-half-hourly level.
The adjustment for each case is designed to minimise one underlying cost-function, whilst conforming to the ESMU's overall half-hourly charging and discharging profile.
In order to treat each cost-function separately $\boldsymbol{\alpha}$ is set to focus on each cost independently, e.g. by setting $\alpha_1 = 1 \text{ and } \alpha_2 = \alpha_3 = \dots = \alpha_9 = 0$.
For simplicity, the flowchart in Figure \ref{ch1:fig:method-evaluation-flowchart} abbreviates the specific costs by only indicating which entry in the $\boldsymbol{\alpha}$ vector is set to $1$, e.g. $\zeta(\alpha_1=1)$ for the preceding example.

All eleven datasets are then assessed in the same manner in order to compare the impact they had had on the network performance.
This underlying assessment is broken into three parts for each dataset:

\begin{enumerate}
	\item \textbf{Time Series Analysis} - 
	The underlying raw profiles are plotted and compared against their respective counterpart cases, in order to link the immediate network impacts to their physical meaning.
	For the same profiles, their corresponding cost profiles are calculated plotted.
	This is done to to highlight how the profiles are interpreted by the cost-functions in terms of improvement (i.e. lower cost) or worsening (i.e. increased cost).
	\item \textbf{Difference Analysis} - 
	The difference in cost profiles, compared to the respective \textit{base} or \textit{normal} case, is calculated and boxplots of these differences are presented to show a statistical spread of improvements or worsening.
	For these plots, a generally positive boxplot skew indicates a general improvement of the underlying network parameters, whilst a generally negative skew does indicate worse performance in regards to the underlying network parameters.
	\item \textbf{Probability Density Analysis} - 
	A set of Probability Density Functions (PDF) is derived for each cost profile using the well established kernel density estimation.
	These PDFs indicate the probability that a certain cost value occurs.
	An improvement is noted when the PDF is shifted towards the lower cost values, whereas a shift towards higher cost values worsened the network performance.
\end{enumerate}





