\begin{figure}\centering
\subfloat[]{%
\begin{tikzpicture}[node distance=2cm, shorten >= 1pt, >=stealth', auto, scale=1, transform shape]
	\draw [<-] (0, 3) to node[pos=0.5,rotate=90,anchor=south]{power} (0, 0);
	\draw [->] (0, 0) to node[pos=0.5,anchor=north]{time} (3, 0);
	\draw (2.25, 0.3) node [fill=green!10,minimum width=0.5cm,minimum height=2.2cm,anchor=south](rect_add) {};
	\draw [very thick]
	(0.0, 2.0) -- (0.5, 2.0) --
	(0.5, 1.3) -- (1.0, 1.3) --
	(1.0, 1.1) -- (1.5, 1.1) --
	(1.5, 0.6) -- (2.0, 0.6) --
	(2.0, 0.3) -- (2.5, 0.3) --
	(2.5, 1.4) -- (3.0, 1.4);
	\draw [thick, green]
	(0.0, 2.0) -- (0.5, 2.0) --
	(0.5, 1.3) -- (1.0, 1.3) --
	(1.0, 1.1) -- (1.5, 1.1) --
	(1.5, 0.6) -- (2.0, 0.6) --
	(2.0, 2.5) -- (2.5, 2.5) --
	(2.5, 1.4) -- (3.0, 1.4);
\end{tikzpicture}%
\label{ch3:subfig:valley-filling-1}%
}
\hspace{10mm}
\subfloat[]{%
\begin{tikzpicture}[node distance=2cm, shorten >= 1pt, >=stealth', auto, scale=1, transform shape]
	\draw [<-] (0, 3) to node[pos=0.5,rotate=90,anchor=south]{power} (0, 0);
	\draw [->] (0, 0) to node[pos=0.5,anchor=north]{time} (3, 0);
	\draw (2.25, 2.0) node [fill=red!10,minimum width=0.5cm,minimum height=0.5cm,anchor=south](rect_sub) {};
	\draw (1.75, 0.6) node [fill=green!10,minimum width=0.5cm,minimum height=0.5cm,anchor=south](rect_add) {};
	\draw [very thick]
	(0.0, 2.0) -- (0.5, 2.0) --
	(0.5, 1.3) -- (1.0, 1.3) --
	(1.0, 1.1) -- (1.5, 1.1) --
	(1.5, 0.6) -- (2.0, 0.6) --
	(2.0, 0.3) -- (2.5, 0.3) --
	(2.5, 1.4) -- (3.0, 1.4);
	\draw [thick, green]
	(0.0, 2.0) -- (0.5, 2.0) --
	(0.5, 1.3) -- (1.0, 1.3) --
	(1.0, 1.1) -- (1.5, 1.1) --
	(1.5, 1.1) -- (2.0, 1.1) --
	(2.0, 2.0) -- (2.5, 2.0) --
	(2.5, 1.4) -- (3.0, 1.4);
	\draw [->, bend right] (rect_sub.180) to (rect_add.90);
\end{tikzpicture}%
\label{ch3:subfig:valley-filling-2}%
}
\hspace{10mm}
\subfloat[]{%
\begin{tikzpicture}[node distance=2cm, shorten >= 1pt, >=stealth', auto, scale=1, transform shape]
	\draw [<-] (0, 3) to node[pos=0.5,rotate=90,anchor=south]{power} (0, 0);
	\draw [->] (0, 0) to node[pos=0.5,anchor=north]{time} (3, 0);
	\draw (2.25, 1.6) node [fill=red!10,minimum width=0.5cm,minimum height=0.4cm,anchor=south](rect_sub_1) {};
	\draw (1.75, 1.0) node [fill=green!10,minimum width=0.5cm,minimum height=0.4cm,anchor=south](rect_add_1) {};
	\draw (1.25, 1.1) node [fill=green!10,minimum width=0.5cm,minimum height=0.3cm,anchor=south](rect_add_2) {};
	\draw [fill=red!10,red!10] (1.5, 1.0) rectangle (2.0,1.1);
	\draw [very thick]
	(0.0, 2.0) -- (0.5, 2.0) --
	(0.5, 1.3) -- (1.0, 1.3) --
	(1.0, 1.1) -- (1.5, 1.1) --
	(1.5, 0.6) -- (2.0, 0.6) --
	(2.0, 0.3) -- (2.5, 0.3) --
	(2.5, 1.4) -- (3.0, 1.4);
	\draw [thick, green]
	(0.0, 2.0) -- (0.5, 2.0) --
	(0.5, 1.3) -- (1.0, 1.3) --
	(1.0, 1.4) -- (1.5, 1.4) --
	(1.5, 1.4) -- (2.0, 1.4) --
	(2.0, 1.6) -- (2.5, 1.6) --
	(2.5, 1.4) -- (3.0, 1.4);
	\draw [->, bend right] (rect_sub_1.180) to (rect_add_2.45);
\end{tikzpicture}%
\label{ch3:subfig:valley-filling-3}%
}
\vspace{1mm}
\subfloat[]{%
\begin{tikzpicture}[node distance=2cm, shorten >= 1pt, >=stealth', auto, scale=1, transform shape]
	\draw [<-] (0, 3) to node[pos=0.5,rotate=90,anchor=south]{power} (0, 0);
	\draw [->] (0, 0) to node[pos=0.5,anchor=north]{time} (3, 0);
	\draw [very thick]
	(0.0, 2.0) -- (0.5, 2.0) --
	(0.5, 1.3) -- (1.0, 1.3) --
	(1.0, 1.1) -- (1.5, 1.1) --
	(1.5, 0.6) -- (2.0, 0.6) --
	(2.0, 0.3) -- (2.5, 0.3) --
	(2.5, 1.4) -- (3.0, 1.4);
	\draw [thick, green]
	(0.0, 2.0) -- (0.5, 2.0) --
	(0.5, 1.42) -- (1.0, 1.42) --
	(1.0, 1.42) -- (1.5, 1.42) --
	(1.5, 1.42) -- (2.0, 1.42) --
	(2.0, 1.42) -- (2.5, 1.42) --
	(2.5, 1.42) -- (3.0, 1.42);
	\draw (1.5, 3.3) node[anchor=south] {$\vdots$};
\end{tikzpicture}%
\label{ch3:subfig:valley-filling-4}%
}
\caption{Charging power allocation for valley-filling behaviour}
\label{ch3:fig:valley-filling}	
\end{figure}